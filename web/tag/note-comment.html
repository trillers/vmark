<note-comment>
    <div class="comment-panel">
        <div class="comment-bar">
            <div class="btn pull-right">
                <div onclick="{addComment}" class="send-btn {active: viewModel.input.withText}">发送</div>
            </div>
            <div class="text-area">
                <input oninput="{noteEditInput}" id="commentTxtInput" placeholder="点击输入评论" value=""/>
            </div>
            <div style="clear: both"></div>
        </div>
    </div>

    <style scoped>
    </style>
    <script>
        var self = this;
        var saveComment = domain.action('saveComment');
        self.viewModel = {
            input: {
                wait: true,
                editTxt: false,
                withText: false,
                doWait: function(){
                    this.wait = true;
                    this.editTxt = false;
                },
                doEdit: function(){
                    this.wait = false;
                    this.editTxt = true;
                }
            }
        };
        self.parent.on('commentMode', function(){
            document.querySelector('#commentTxtInput').focus();
        });
        self.quitComment = function(e){
            self.parent.trigger('quitComment');
        };
        self.addComment = function(e){
            if(self.commentTxtInput.value.trim() === ''){
                return;
            }
            self.viewModel.input.withText = false;
            saveComment.newInvocation({
                note: self.parent.currComment._id,
                interaction: {
                    initiator: self.parent.user._id,
                    content: self.commentTxtInput.value.trim()
                }
            }).onDone(function(data){
                self.commentTxtInput.value = '';
                self.viewModel.input.doWait();
                self.parent.trigger('noteComment', data.comment);
            }).execute();
        };
        self.noteEditInput = function(e){
            var txtVal = e.currentTarget.value.trim();
            self.viewModel.input.withText = !!txtVal;
            if(txtVal){
                self.viewModel.input.doEdit();

            }else{
                self.viewModel.input.doWait();
            }
        };

    </script>
</note-comment>