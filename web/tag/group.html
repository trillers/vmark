<group>
    <div if="{!hidden}">
        <div class="row-fluid" style="overflow: hidden; background: #eee;margin-top:-6px">
            <div class="col-md-4 col-xs-4 col-sm-4" style="padding-right: 0; padding-left: 0; width: 30%">
                <div class="well sidebar-nav" style="padding-top: 0; padding-right: 0; padding-left: 0;height: 48em; background-color:  #2E3238; border: 1px solid #080808; overflow: scroll; border-radius: 0">
                    <ul style="padding: 0; margin: 0; list-style-type: none">
                        <li style="height: 50px; border-bottom:2px solid #252525; line-height: 50px;overflow: hidden">
                            <div class="col-md-8 col-xs-8 col-sm-8" style="height:50px;line-height:50px;overflow: hidden">
                                <div style="padding-left:10px;background: #24272C;height: 32px; margin-top: 8px;line-height:32px;color: #777">
                                    <b style="width:20%;">
                                        <span class="glyphicon glyphicon-search"></span>
                                    </b>
                                    <input type="text" style="background: transparent;border: none;width:80%" placeholder="搜索"/>
                                </div>
                            </div>
                            <div class="col-md-4 col-xs-4 col-sm-4" style="height:50px;overflow: hidden;">
                                <div style="height:32px;margin-top: 6px;line-height: 32px">
                                    <button type="button" onclick="{addGroup}" class="btn btn-sm" style="background: #42AC3E; color:white">
                                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 添加分组
                                    </button>
                                </div>
                            </div>
                        </li>
                        <li onclick="{viewGroup}" each="{groups}" style="height: 64px;line-height: 50px;border-bottom:2px solid #252525;padding: 5px 20px; cursor: pointer">
                            <span style="color: white; margin-left: 15px">{name}</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-8 col-xs-8 col-sm-8" style="background:#eee;padding-right: 1px; padding-left: 0;width: 70%">
                <view-group if="{panel.status === 'view'}"/>
                <add-group if="{panel.status === 'add'}"/>
            </div>
        </div>
    </div>
    <style scoped>

    </style>
    <script>
        this.app = this.opts.app; //keep spa object
        var self = nest.presentable(this);
        self.env = (__app.settings.env.NODE_ENV=="production")?"public":"web";
        self.api =  __app.settings.api.url;
        self.botId = __page.bot.customId;
        self.tip = false;
        self.tipInfo = "";

        var loadAllMyManageMedia = domain.action('loadAllMyManageMedia');
        var loadGroups = domain.action('loadGroups');

        var onLoadGroups = function(data){
            console.warn(data)
            self.update({groups: data.groups});
        };
        var onLoadAllMyManageMedia = function(data){
            self.myManageMedia = data.medias;
            self.panel.add();
            self.update();
        };

        this.on('mount', function(){
            loadAllMyManageMedia.onDone(onLoadAllMyManageMedia);
            loadGroups.onDone(onLoadGroups);
        });
        this.on('unmount', function(){
            loadAllMyManageMedia.offDone(onLoadAllMyManageMedia);
            loadGroups.offDone(onLoadGroups);
        });
        this.on('open', function(options){
            console.info('tag group index is opening');
            self.trigger('ready', false);
            self.trigger('view-route-to');
            console.log( __page.user)
            loadGroups.execute({tenantId:__page.user.posts[0].org, operatorId: __page.user.posts[0].member});
        });

        this.on('leave', function(){
            self.mask = true;
            self.update();
        });

        this.on('reenter', function(){
            self.mask = false;
            self.update();
        });

        this.on('refresh', function(){
            console.info('tag group index is refreshing');
            //_refresh();
        });

        self.formatDate = function(date){
            var dateStr = new Date(date).toLocaleDateString();
            return dateStr.replace(/\//g, '-');
        }

        self.panel ={
            status: 'view',
            add:function(){
                this.status = 'add'
            },
            view: function(){
                this.status = 'view'
            }
        };
        viewGroup(e){
            alert(1)
        }
        addGroup(e){
            var w = self.panel;
            if(w.status === 'add'){
                return
            }
            loadAllMyManageMedia.execute({tenantId: __page.user.posts[0].org, operatorId: __page.user.posts[0].member});
        }
    </script>
</group>