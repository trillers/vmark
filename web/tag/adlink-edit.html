<adlink-edit>
    <div if="{!hidden}">
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="col-sm-12  col-md-12  col-lg-12" >
                <div id="adlink-msg" class="alert alert-danger alert-dismissible fade in hidden" style="margin-left: 20px;" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4></h4> <div id="msgs"></div>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="col-sm-12  col-md-12  col-lg-12" >

                <form class="form-horizontal" id="adlink-edit">
                    <div class="form-group">
                        <label for="name" class="col-sm-2 col-md-2 col-lg-2 control-label">名称</label>
                        <div class="col-sm-10 col-md-10 col-lg-10">
                            <input type="text" class="form-control" id="name" placeholder="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="adwords" class="col-sm-2 col-md-2 col-lg-2 control-label">广告标题</label>
                        <div class="col-sm-10 col-md-10 col-lg-10">
                            <input type="text" class="form-control" id="adwords" placeholder="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="url" class="col-sm-2 col-md-2 col-lg-2 control-label">广告链接</label>
                        <div class="col-sm-10">
                            <input type="url" class="form-control" id="url" placeholder="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone" class="col-sm-2 col-md-2 col-lg-2 control-label">客服电话</label>
                        <div class="col-sm-10 col-md-10 col-lg-10">
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <input type="checkbox" aria-label="..." id="hasPhone">
                                </span>
                                <input type="phone" class="form-control" id="phone" placeholder="" onblur={onPhoneBlur}>
                            </div><!-- /input-group -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="layout" class="col-sm-2 col-md-2 col-lg-2 control-label">位置</label>
                        <div class="col-sm-10 col-md-10 col-lg-10">
                            <div class="btn-group" data-toggle="buttons">
                                <input type="hidden" id="layout" name="layout" value="bottom">
                                <label class="btn btn-default active" onclick={onSyncLayout}>
                                    <input type="radio" name="layoutRadio" id="layoutBottom" autocomplete="off" checked value="bottom">底部
                                </label>
                                <label class="btn btn-default" onclick={onSyncLayout}>
                                    <input type="radio" name="layoutRadio" id="layoutTop" autocomplete="off" value="top">顶部
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="theme" class="col-sm-2 col-md-2 col-lg-2 control-label">主题</label>
                        <div class="col-sm-10 col-md-10 col-lg-10">
                            <div class="btn-group" data-toggle="buttons">
                                <input type="hidden" id="theme" name="theme" value="dark">
                                <label class="btn btn-default active" onclick={onSyncTheme}>
                                    <input type="radio" name="themeRadio" id="themeDark" autocomplete="off" checked value="dark">深色
                                </label>
                                <label class="btn btn-default" onclick={onSyncTheme}>
                                    <input type="radio" name="themeRadio" id="themeLight" autocomplete="off" value="light">浅色
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-md-offset-2 col-lg-offset-2 col-sm-10 col-md-10 col-lg-10">
                            <button type="button" class="btn btn-primary" onclick={onSave}>保存</button>
                        </div>
                    </div>
                </form>

            </div>
        </div>
    </div>
    </div>
    <style scoped>

    </style>

    <script>
        var self = nest.presentable(this);
        self.api =  __app.settings.api.url;
        self.adlink = {};
        var saveAdlink = domain.action('saveAdlink');

        var onSaveAdlink = function(adlink){
            self.adlink = adlink;
            self.update();
        };

        this.on('mount', function(){
            saveAdlink.onDone(onSaveAdlink);
        });
        this.on('unmount', function(){
            saveAdlink.offDone(onSaveAdlink);
        });

        self.on('open', function(tenantId){
            self.tenantId = tenantId;
            self.adlink.org = tenantId;
            self.hidden = false;
            self.update();
        });

        self.on('close', function(){
            self.hidden = true;
            self.update();
        });

        function trim(str) {
            if(!str) return '';
            return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, '');
        }

        var model = {};

        onSave(e){
            var msgs = [];
            model.org = self.tenantId;

            model.name = $('#adlink-edit #name').val();
            if(trim(model.name)=='') msgs.push('<p>"名称"不能为空</p>');

            model.adwords = $('#adlink-edit #adwords').val();
            if(trim(model.adwords)=='') msgs.push('<p>"广告标题"不能为空</p>');

            model.url = $('#adlink-edit #url').val();
            if(trim(model.url)=='') msgs.push('<p>"广告链接"不能为空</p>');

            model.phone = $('#adlink-edit #phone').val();

            model.layout = $('#adlink-edit #layout').val();
            model.theme = $('#adlink-edit #theme').val();

            if(msgs.length){
                $('#adlink-msg #msgs').html(msgs.join(''));
                $('#adlink-msg').removeClass('hidden');
            }
            else{
                $('#adlink-msg #msgs').html('');
                $('#adlink-msg').addClass('hidden');
                saveAdlink.execute(model);
            }
            console.log(model);
        }

        onSyncLayout(e){
            $('#adlink-edit #layout').val( $(e.currentTarget).find('input').val() );
        }

        onSyncTheme(e){
            $('#adlink-edit #theme').val( $(e.currentTarget).find('input').val() );
        }

        onPhoneBlur(e){
            var phone = $(e.currentTarget).val();
            $('#adlink-edit #hasPhone').prop("checked", trim(phone)!=='');
        }

    </script>
</adlink-edit>