<catalog-index>
    <div>
        <div>产品目录</div>
        <div if="{!catalog || !catalog.products || !catalog.products.length}">
            该机构尚没有上架任何课程
        </div>
        <div if="{catalog.products && catalog.products.length}">
            <ul class="catalog-card">
                <li each="{catalog.products}" onclick="{parent.routeTo}">
                    <div style="background-image:url('{__app.settings.api.url + '/file?media_id=' + poster}')">
                        <!--<img riot-src="{poster &&__app.settings.api.url + '/file?media_id=' + poster}"/>-->
                    </div>
                    <div>
                        <div>{name}</div>
                        <div>{slogan}</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <style>
        .catalog-card{
            margin: 0px;
            padding: 0px;
        }
        .catalog-card li{
            list-style-type:none;
            min-height: 60px;
            border-bottom: 1px solid #ddd;
        }
        .catalog-card li >div{
            float: left;
            margin-left: 10px;
            margin-top: 10px;
        }
        .catalog-card li >div:first-child{
            width: 40px;
            height: 40px;
            background-size: 100% 100%;
            margin-top: 10px;
            float: left;
        }
        .catalog-card li >div:first-child >img{
            width: 40px;
        }
    </style>

    <script>
        this.mixin('dispatcher');

        this.on('mount', function(){
            this.on('loadCatalogById', function(res){
                this.update({catalog: res.catalog});
            });
            this.dispatch(actions.loadCatalogById(this.opts.id));
        })
        console.error(this.opts.id);
        $.get(__app.settings.api.url + '/tenant/sd/catalog/_' + this.opts.id)
                .success(res=>{
            console.error(res);

        })
        .error(e=>{
            console.warn(e.stack)
        })

        this.routeTo = function(e){
            window.location = __app.settings.app.url + "/sd/" + __page.user.wechatId + "/product?id=" + e.item._id + '&media=' + this.catalog.media._id;
        }

    </script>
</catalog-index>